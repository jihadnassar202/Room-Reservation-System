{% extends "base.html" %}

{% block title %}My Reservations Â· Room Reservation{% endblock %}

{% block content %}
  <div class="row g-3">
    <div class="col-12">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
        <div>
          <h1 class="h4 mb-1">My Reservations</h1>
          <div class="text-body-secondary">
            Upcoming reservations can be edited/cancelled later. Past reservations are view-only.
          </div>
        </div>
        <a class="btn btn-primary" href="{% url 'reservations:checkout' %}">Go to Checkout</a>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body p-4">
          <div class="d-flex align-items-center justify-content-between gap-2 mb-3">
            <h2 class="h6 mb-0">Upcoming</h2>
            <span class="badge text-bg-primary" id="upcomingCount" aria-live="polite">{{ upcoming|length }}</span>
          </div>

          {% if upcoming %}
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead>
                  <tr>
                    <th scope="col">Room</th>
                    <th scope="col">Date</th>
                    <th scope="col">Time</th>
                    <th scope="col" class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody id="upcomingBody">
                  {% for r in upcoming %}
                    <tr data-reservation-row data-reservation-id="{{ r.id }}">
                      <th scope="row" class="fw-semibold">{{ r.room_type.name }}</th>
                      <td>{{ r.date }}</td>
                      <td>{{ r.get_slot_display }}</td>
                      <td class="text-end">
                        <a
                          class="btn btn-sm btn-outline-secondary"
                          href="{% url 'reservations:reservation_edit' r.id %}"
                          aria-label="Edit reservation for {{ r.room_type.name }} on {{ r.date }} at {{ r.get_slot_display }}"
                        >
                          Edit
                        </a>
                        <button
                          type="button"
                          class="btn btn-sm btn-outline-danger"
                          data-action="cancel"
                          data-reservation-id="{{ r.id }}"
                          aria-label="Cancel reservation for {{ r.room_type.name }} on {{ r.date }} at {{ r.get_slot_display }}"
                        >
                          Cancel
                        </button>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-body-secondary" id="upcomingEmpty">
              No upcoming reservations yet.
              <div class="d-flex flex-wrap gap-2 mt-3">
                <a class="btn btn-sm btn-primary" href="{% url 'reservations:checkout' %}">Go to Checkout</a>
                <a class="btn btn-sm btn-outline-primary" href="{% url 'reservations:reservation_create' %}">New Reservation</a>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body p-4">
          <div class="d-flex align-items-center justify-content-between gap-2 mb-3">
            <h2 class="h6 mb-0">Past</h2>
            <span class="badge text-bg-secondary" id="pastCount" aria-live="polite">{{ past|length }}</span>
          </div>

          {% if past %}
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead>
                  <tr>
                    <th scope="col">Room</th>
                    <th scope="col">Date</th>
                    <th scope="col">Time</th>
                    <th scope="col" class="text-end">Status</th>
                  </tr>
                </thead>
                <tbody>
                  {% for r in past %}
                    <tr>
                      <th scope="row" class="fw-semibold">{{ r.room_type.name }}</th>
                      <td>{{ r.date }}</td>
                      <td>{{ r.get_slot_display }}</td>
                      <td class="text-end">
                        <span class="badge text-bg-success">Completed</span>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-body-secondary">No past reservations.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  {% load static %}
  <script src="{% static 'js/reservations/my_reservations.js' %}"></script>
{% endblock %}



